# Pentest Management (ptM)

ptM is frontend which gives the user the ability to manage different pentest projects. A limited set of popular tools like massdns, nmap or wpscan can be executed with a click.

## Important - Read first!
This tool is designed to execute shell commands on the underlying ubuntu web server! Its also necessary to install different python and ruby tools as root user via git. You have to know what you are doing! Therefore my recommendation is not to install this kind of tool on systems/servers where other websites are located. __Buy a cheap vps!__

Also: read this install from top to bottom!

## Security
Since this tool works a lot with shell commands and its possible to execute different commands, I recommend to protect this tool via __htaccess__ and/or __"allow from YOURIP"__! Please don't report issues like "RCE" - thats by design ;) This is basically a pretty bash shell! 

## Features

- Login/Logout as admin
- Simple user management
- Adding "projects" (main domains) and scanning those with massdns or sublister
- Adding subdomains to a project and scanning those with dirsearch, nmap, wpscan (more to come...)
- Adding notes, http status, headers, redirects, cname, ips, ... (this data will be gathered automatically)
- Observing system queue and interacting with it - "tsp" is necessary!

## Preinstall

This tool was developed under Ubuntu 16.04, mysql 5.7, nginx and PHP 7.2 - since I decided to use nullable types and void as return type, __PHP >= 7.1__ is necessary! 

__You also need__:

1. Python 2.7
2. Python 3
3. Ruby2

Please use "whereis" to get the absolute paths!

For the heavy load stuff, I'm using "tsp", this also needs to be installed:

```bash
sudo apt-get install task-spooler
```

__nmap__

Dead simple installation using apt-get:

```bash
sudo apt-get install nmap
```

__git__
```bash
sudo apt-get install git
```

__pip and pip3__

```bash
sudo apt-get install python-pip python3-venv python3-pip
```

__dig__

dig is usually preinstalled on all ubuntu servers.

__supervisor__
```bash
sudo apt-get install supervisor
```

Please take a look at the [Laravel Docs for more info about supervisor](https://laravel.com/docs/5.6/queues#supervisor-configuration)!
__npm & yarn & composer__

- [NPM/NodeJS Installation](https://nodejs.org/en/download/package-manager/#debian-and-ubuntu-based-linux-distributions)
- [yarn Installation](https://yarnpkg.com/lang/en/docs/install/)
- [composer Installation](https://getcomposer.org/doc/00-intro.md#globally)

### Third party tools

I'm using different third party tools, some of them require you to install different dependencies as root user. Please take a look at the repositories.

__Every tools needs to be located within the "toolset" folder in the base path.__

- massdns [-> Github](https://github.com/blechschmidt/massdns)
- sublist3r [-> Github](https://github.com/aboul3la/Sublist3r)
- dirsearch [-> Github](https://github.com/maurosoria/dirsearch)
- wpscan [-> Github](https://github.com/wpscanteam/wpscan)


## 1. Install Laravel 5.6

This tool is based on "Laravel 5.6" - take a look at [the official website](https://laravel.com/docs/5.6/installation) to get an idea whats important when installing Laravel.

The steps are quite simple:

1. Clone this repo into you folder
2. Edit example.env and rename it to ".env"
3. It's important to edit the database credentials, updating the url and setting the "TOOLSET_BIN_*" variables - just use "whereis" to get the full paths of PHP 7.2, Ruby2 and Python 2/3.
4. Under normal circumstances you won't need to change the "TOOLSET_PATH_*" Variables! So just ensure everything is there ;)

__Installing Laravel:__

```bash
composer install
```

__Compiling assets via Laravel mix:__
```bash
yarn install && npm run prod
```

__Regenerate app key:__
```bash
php artisan key:generate
```

__Migrate database and seed data__
```bash
php artisan migrate:fresh --seed
```

__Create symbolic link to storage__
```bash
php artisan storage:link
```

__chmod storage and cache-folder__
```bash
chmod -R 777 bootstrap/cache
chmod -R 777 storage
```
__Configure webserver__

Take a look at the [Laravel documentation](https://laravel.com/docs/5.6/installation)

__Configure supervisor__

Supervisor manages the laravel workers which process the laravel queue. I'm using it for simple quick jobs like crawling urls or fetching dns data for a subdomain. Heavy load is send to task spooler since its ay more robust (in my case) when combined with massdns etc. I assume, supervisor is installed!
```bash
nano /etc/supervisor/conf.d/laravel-worker-low.conf
```

Content of this file (!!!you have to update it to your paths!!!):
```bash
[program:laravel-worker-low]
process_name=%(program_name)s_%(process_num)02d
command=php /home/vagrant/ptm/artisan queue:work --queue=default,low --sleep=3
autostart=true
autorestart=true
user=vagrant
numprocs=5
redirect_stderr=true
stdout_logfile=/home/vagrant/ptm/storage/logs/low-worker.log
```

If your vps/server is not that strong you may set the numprocs to 2-3, if you have a strong server... 10 may be fine ;)

IMPORTANT:

Now reread and restart supervisor:
```bash
sudo supervisorctl reread
sudo supervisorctl update
sudo supervisorctl start laravel-worker-low:*
```

__Configure schedule system__

Laravel has a unique and very simple schedule system. Specific jobs (in my case its "updateDnsAndHttpData" for new subdomains) will be put in the "low" queue by the schedule system and executed by the queue workers (supervised by supervisor). To activate this system, which is a cronjob, you have to add it to your cronjob file (I'm using crontab -e):
```bash
* * * * * /usr/bin/php7.2 /path-to-your-project/artisan schedule:run >> /dev/null 2>&1
```

## 2. Install dirsearch, massdns, sublist3r and wpscan

```bash
sh install-third-party.sh
```

ATTENTION: This clones all repos, installs every ruby and python2/3 dependency and also important ubuntu build tools. You will have to allow some of the steps!

## 3. Rights...

Depending on which user you use to install all deps and scripts, it may be necessary to chmod some folders:
```bash
chmod -R 777 toolset/dirsearch/logs/
chmod -R 777 toolset/dirsearch/reports/
```

## Login

- Login: mail [at] damianschwyrz.de
- Passwort: 123456

From now on, you can change the credentials or add new users.

## What about own wordlists

Take a look at folder toolset/wordlists. There are some predefined wordlists for massdns/subbrute and some for dirsearch. You may just add new one and the frontend will find them automatically. The predefined are taken from:
1. [https://github.com/danielmiessler/SecLists/](https://github.com/danielmiessler/SecLists/)
2.  [https://github.com/jhaddix](https://github.com/jhaddix)

## Screenshots

![Image of tsp output](https://i.imgur.com/kEjlSrx.png)
![Image of projects subdomains](https://i.imgur.com/BjU1GX2.png)
![Image of project overview+actions](https://i.imgur.com/d5lwH6m.png)
![Image of domain actions](https://i.imgur.com/aUmJgJY.png)
![Image of changing status](https://i.imgur.com/LvAAwdQ.png)
![Showing content](https://i.imgur.com/NeeJJjF.png)
![Tracking process status](https://i.imgur.com/YKseKWO.png)
![wpscan interface](https://i.imgur.com/mLg4SJ4.png)
![dirsearch interface](https://i.imgur.com/JPSYBRL.png)
![user](https://i.imgur.com/0706FyR.png)

## TODO

1. User Management
2. Extended User Management -> Superadmin, Admin, Spectator
3. Tests
4. CMS Enumeration
5. aquatone integration
6. other tools
7. activate more options for attacking sites (via wpscan, ...)
9. show ps aux and controll (kill, ...) processes

## Notes to myself:

- Important feature: User Management
   - Super admin -> admin -> spectator
     - Super can do everything
     - Admin can manage his own projects, no access to tsp
     - Spectator can see projects/targets but cant alter