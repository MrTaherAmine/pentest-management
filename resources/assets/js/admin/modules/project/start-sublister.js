/*
 * Author: Damian Schwyrz <mail@damianschwyrz.de>
 * URL: https://www.damianschwyrz.de
 * Copyright (c) 2018.
 */


$(function () {


    $('#prepare-sublister-modal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget);

        var domain = button.data("domain");
        var route = button.data("href");

        $("#start-sublister").data("route", route);
        $("#start-sublister").attr("data-route", route);

        $("#sublister-url").val(domain);
    });

    $('#prepare-sublister-modal').on('hide.bs.modal', function () {
        $("#sublister-url").val("");
        $("#sublister-threads").val("12");
        $("#start-sublister").find(".fa").addClass("hidden");
    });

    $(document).on('click', "#start-sublister", function (event) {
        event.preventDefault();
        var domain = $("#sublister-url").val();
        var threads = $("#sublister-threads").val();
        var route = $(this).data("route");



        $(this).find(".fa").removeClass("hidden");

        $.ajax({
            url: route,
            type: 'POST',
            data: {
                domain: domain,
                threads: threads
            },
            success: function (result) {
            },
            error: function (result) {
                loadInfoBox("#infobox", "Problem occured while starting sublister.");
            },
            complete: function (result) {
                console.log(result);
                $('#prepare-sublister-modal').modal('hide');

                loadInfoBox("#infobox", "Sublister is in queue - come back later ;)");
            }
        });

    });
});
