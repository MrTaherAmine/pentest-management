/*
 * Author: Damian Schwyrz <mail@damianschwyrz.de>
 * URL: https://www.damianschwyrz.de
 * Copyright (c) 2018.
 */

window.changeProgressStatusLabel = function (targetID, newstatus) {
    var a = $(".change-progress-status-btn-id-" + targetID);
    a.data("current", newstatus);

    if (newstatus === "new") {
        a.html('<span class="label label-primary">New</span>');
        return true;
    }

    if (newstatus === "checking") {
        a.html('<span class="label label-warning">Checking</span>');
        return true;
    }

    if (newstatus === "checked") {
        a.html('<span class="label label-success">Checked</span>');
        return true;
    }
    if (newstatus === "unknown") {
        a.html('<span class="label label-danger">Unknown</span>');
        return true;
    }

};

$(function () {

    $('#change-status-modal').on('show.bs.modal', function (event) {
        var modal = $(this);
        var button = $(event.relatedTarget);
        var subdomain_id = button.data("id");
        var current_status = button.data("current");

        console.log(subdomain_id, current_status);

        modal.find(".change-progess-status").removeClass("hidden");
        modal.find("a[data-value=" + current_status + "]").addClass("hidden");
        modal.find(".change-progess-status").data("subdomain-id", subdomain_id);

    });

    $('.change-progess-status').on('click', function (event) {
        event.preventDefault();
        var subdomain_id = $(this).data('subdomain-id');
        var status_value = $(this).data('value');

        console.log(subdomain_id, status_value);

        $.ajax({
            url: "/admin/target/" + subdomain_id + "/status",
            type: 'PATCH',
            data: {id: subdomain_id, status_value: status_value},
            success: function (result) {
                changeProgressStatusLabel(subdomain_id, status_value);
                $('#change-status-modal').modal('hide');
            },
            error: function (result) {
                console.log(result);
            }
        });


    });
});