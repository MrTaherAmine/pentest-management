@extends('layouts.admin-dashboard')

@section('breadcrumbs')

    <section class="content-header">
        <h1>
            Archived subdomains within project "{{ $project->name }}"
            <a class="pull-right btn btn-primary" href="{{ route('admin.target.create',$project) }}"><i class="fa fa-plus"></i>
                Add new subdomain</a>
        </h1>
    </section>

@endsection

@section('content')
    <div class="row">
        <div class="col-xs-12">

            @if($project->activeTargets->count())
                <div class="box">
                    <div class="box-body table-responsive no-padding">
                        <table class="table table-hover">
                            <thead>
                            <tr>
                                <th>Subdomain</th>
                                <th>IP Adress</th>
                                <th>CNAME</th>
                                <th>Status</th>
                                <th>HTTP-Responses</th>
                                <th>Ports</th>
                                <th>Filescan</th>
                                <th>Note</th>
                                <th></th>
                                <th></th>
                            </tr>
                            </thead>

                            <tbody>
                            @foreach($project->archivedTargets as $target)
                                <tr class="target-{{ $target->id }}">

                                    <td>
                                        <a href="#" class="copy-to-clipboard">{{ $target->subdomain }}</a>
                                        <a class="pull-right" href="{{ route('admin.target.edit',$target) }}"><span class="label label-default">Edit</span></a>
                                    </td>

                                    <td>
                                        @include('admin.target.parts.ip',['ip' => $target->ip, 'subdomain' => $target->subdomain])
                                    </td>

                                    <td>
                                        @include('admin.target.parts.cname',['cname' => $target->cname])
                                    </td>

                                    <td>
                                        <a class="change-target-status change-target-wrapper-{{ $target->id }}" data-id="{{ $target->id }}" href="#">
                                            @include('admin.target.parts.progress-status',['status' => $target->status])
                                        </a>
                                    </td>

                                    <td>
                                        <span class="badge @include('admin.target.parts.status-badge',['responsecode' => $target->http_status])" data-toggle="tooltip" data-placement="top" title="Code: {{ $target->http_status }} Redirect: {{ $target->http_redirected }}">http</span>
                                        <span class="badge @include('admin.target.parts.status-badge',['responsecode' => $target->https_status])" data-toggle="tooltip" data-placement="top" title="Code: {{ $target->https_status }} Redirect: {{ $target->https_redirected }}">https</span>
                                    </td>

                                    <td>
                                        @include('admin.target.tools.portscan', ['id' => $target->id, 'open_ports' => $target->open_ports])
                                    </td>

                                    <td>
                                        @include('admin.target.tools.files_dirs_found', ['id' => $target->id, 'files_dirs_found' => $target->files_dirs_found])
                                    </td>

                                    <td>
                                        @include('admin.target.tools.note', ['id' => $target->id, 'note' => $target->note])
                                    </td>

                                    <td>
                                        {{ $target->created_at->format('Y-m-d') }}
                                        <small>{{ $target->created_at->format('H:i') }}</small>
                                    </td>

                                    <td>
                                        <a href="{{ route('admin.target.destroy',$target) }}" data-id="{{ $target->id }}" class="destroy-target pull-right">
                                            <span class="label label-danger">Delete</span>
                                        </a>
                                        <a href="{{ route('admin.target.archive',$target) }}" data-id="{{ $target->id }}" class="archive-target pull-right">
                                            <span class="label label-warning">Unhide</span>
                                        </a>
                                    </td>

                                </tr>
                            @endforeach
                            </tbody>
                        </table>
                    </div>
                </div>
            @else
                <div class="alert alert-warning">
                    <i class="fa fa-warning"></i> Sorry - no active targets were found within this project.
                </div>
            @endif

        </div>


        <div class="col-md-6">
            <a class="btn btn-primary" href="{{ route('admin.project.show',$project) }}">
                <i class="fa fa-archive"></i> Current ({{ $project->activeTargets->count()  }} projects)
            </a>
        </div>

        <div class="col-md-6">
            <a class="pull-right btn btn-primary" href="{{ route('admin.target.create',$project) }}">
                <i class="fa fa-plus"></i> Add new subdomain
            </a>
        </div>

    </div>
@endsection

@push('script-files')
    <script src="{{ asset('js/admin/modules/target.index.js') }}"></script>
@endpush

@push('modals')

    <div class="modal modal-info" id="content-modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title"><i class="fa fa-spin fa-spinner"></i></h4>
                </div>
                <div class="modal-body">
                    <i class="fa fa-spin fa-spinner"></i>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline pull-left" data-dismiss="modal">
                        Close
                    </button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <!-- /.modal -->

    <div id="c-and-p">
        <div class="alert alert-info">
            <span></span>
        </div>
    </div>


@endpush