<?php
/**
 * Author: Damian Schwyrz <mail@damianschwyrz.de>
 * URL: https://www.damianschwyrz.de
 * Copyright (c) 2018.
 */

namespace App\System;


use Illuminate\Support\Facades\File;
use Symfony\Component\Process\Process;

/**
 * Class FolderContent
 * @package App\System
 */
class FolderContent
{

    /**
     * @var array
     */
    private $files = [];


    /**
     * FolderContent constructor.
     *
     * @param string $pathWithinStorage
     */
    public function __construct(string $pathWithinStorage)
    {
        $files = File::files(base_path("$pathWithinStorage"));
        $this->pushWordlistsToResult($files);


    }

    /**
     * @param array $files
     */
    protected function pushWordlistsToResult(array $files): void
    {
        foreach ($files as $file) {

            $list = new \stdClass();
            $list->name = $file->getBasename();
            $list->lines = $this->getLineCount($file->getRealPath());

            $this->files[] = $list;

        }
    }

    /**
     * The fastest way to count lines is just use good old ubuntu "wc -l".
     *
     * @param string $filePath
     *
     * @return string
     */
    private function getLineCount(string $filePath): string
    {
        $process = new Process("wc -l " . $filePath . " | cut -f1 -d ' '");
        $process->run();

        return trim($process->getOutput());
    }

    /**
     * @return array
     */
    public function all(): array
    {
        return $this->files;
    }
}